<h2><%= hr_index %> &#187; <%= l(:label_contact_list) %></h2>

<% if @user_positions.any? %>
  <table class="list contact_list">
    <thead><tr>
        <th><%=l(:label_avatar)%></th>
        <th><%=l(:label_user)%></th>
        <th><%=l(:label_position)%></th>
        <th><%=l(:field_mail)%></th>

        <% available_custom_fields=UserDetails.new.available_custom_fields %>
        <% for custom_field in available_custom_fields %>
          <th>
            <% if custom_field.is_public %>
              <%=h custom_field.name %>
            <% end %>
          </th>
        <% end %>

      </tr></thead>
    <tbody>
      <% previous_position_id=0 %>
      <% @user_positions.each do |user_position| %>
        <% if user_position.position_id!=previous_position_id %>
          <% previous_position_id=user_position.position_id %>
          <tr>
            <th colspan="<%= 4+available_custom_fields.length%>"><%= user_position.position.title %></th>
          </tr>
        <% end %>
        <tr class="<%= cycle 'odd', 'even' %>">
          <td><%= avatar(user_position.user, :size => "60") %></td>
          <td><%= link_to_user user_position.user %></td>
          <td><%= user_position.position.title %> </td>
          <td><%= mail_to(user_position.user.mail) %> </td>


          <% user_details = UserDetails.find(:first,:conditions =>["user_id=?", user_position.user_id]) %>
          <% if user_details!=nil %>
            <% for custom_value in user_details.custom_field_values %>
              <td>
                <% if !custom_value.value.blank? and !custom_value.custom_field.is_public==false %>
                  <%=h show_value(custom_value) %>
                <% end %>
              </td>
            <% end %>
          <% else %>
            <% for i in available_custom_fields%>
              <td></td>
            <%  end %>
          <% end %>

        </tr>
      <% end  %>

    </tbody>
  </table>
<% else %>
  <p class="nodata"><%= l(:label_no_data) %></p>
<% end %>